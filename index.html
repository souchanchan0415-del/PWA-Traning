<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Train Punch — 筋トレロガー</title>
  <meta name="theme-color" content="#111111">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css?v=1.2.1">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Train Punch">
  <style>
    /* 2段タブ用の軽量スタイル（既存CSSに追加されてもOK） */
    .pills{display:flex;gap:8px;flex-wrap:wrap}
    .pills button{padding:8px 12px;border-radius:999px;border:1px solid var(--line,#e3e3e3);background:transparent}
    .pills button.active{background:var(--accent,#0db);color:#fff;border-color:transparent}
    .scrollchips{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px}
    .scrollchips button{white-space:nowrap;padding:8px 12px;border-radius:999px;border:1px solid var(--line,#e3e3e3);background:transparent}
    .scrollchips button.active{background:var(--accent,#0db);color:#fff;border-color:transparent}
    .muted{color:#999;font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>Train Punch</h1>
    <nav class="tabs">
      <button data-tab="session" class="active">セッション</button>
      <button data-tab="history">履歴</button>
      <button data-tab="analytics">分析</button>
      <button data-tab="settings">設定</button>
    </nav>
  </header>

  <main>
    <!-- セッション -->
    <section id="tab-session" class="tab active">
      <div class="card">
        <div class="row">
          <label>日付</label>
          <input id="sessDate" type="date">
        </div>
        <div class="row">
          <label>メモ</label>
          <input id="sessNote" placeholder="任意メモ">
        </div>

        <!-- ▼ 2段タブ: 部位 → 種目 -->
        <div class="row">
          <label>部位</label>
          <nav id="partTabs" class="pills"></nav>
        </div>
        <div class="row" style="align-items:flex-start">
          <label>種目</label>
          <div style="flex:1;min-width:0">
            <div id="exChips" class="scrollchips"></div>
            <div class="muted" id="exCurrentLabel" style="margin-top:6px"></div>
          </div>
          <!-- 互換用に hidden select を維持（JSから更新） -->
          <select id="exSelect" style="display:none"></select>
          <button id="btnAddEx" class="ghost" style="margin-left:8px">＋追加</button>
        </div>
        <!-- ▲ 2段タブ -->

        <div class="grid3">
          <input id="weight" inputmode="decimal" placeholder="重量(kg)">
          <input id="reps" inputmode="numeric" placeholder="回数">
          <input id="rpe" inputmode="decimal" placeholder="RPE(任意)">
        </div>
        <div class="row">
          <button id="btnAddSet">セット追加</button>
          <button id="btnTimer" class="ghost">休憩60s</button>
        </div>
      </div>

      <!-- クイック/カスタム投入は現状のまま（必要なら後でタブ化も可） -->
      <div class="card">
        <h3>クイック投入（履歴）</h3>
        <div class="row">
          <label>種目</label>
          <select id="tplExFromHist"></select>
        </div>
        <div class="row">
          <label>パターン</label>
          <select id="tplPattern"></select>
          <label style="margin-left:8px">
            <input id="tplUseLastW" type="checkbox" checked>
            前回重量を使う
          </label>
          <button id="btnTplApply" class="ghost">投入</button>
        </div>
        <small>パターンは履歴から自動生成（例：5×5, 3×8, 4×10）。重複はまとめて頻度順に並びます。</small>
      </div>

      <div class="card">
        <h3>カスタム投入</h3>
        <div class="grid3">
          <input id="tplCustomSets"  inputmode="numeric"  placeholder="セット数（例 5）">
          <input id="tplCustomReps"  inputmode="numeric"  placeholder="回数（例 5）">
          <input id="tplCustomWeight" inputmode="decimal" placeholder="重量kg（例 40）">
        </div>
        <div class="row">
          <label>種目</label>
          <select id="tplExCustom"></select>
          <button id="btnTplCustom">投入</button>
        </div>
      </div>

      <div class="card">
        <h3>今日のセット</h3>
        <ul id="todaySets" class="list"></ul>
        <div class="row end">
          <button id="btnSaveSession">セッション保存</button>
        </div>
      </div>
    </section>

    <!-- 履歴 -->
    <section id="tab-history" class="tab">
      <div class="card">
        <div class="row">
          <label>表示件数</label>
          <select id="historyCount">
            <option>10</option>
            <option selected>20</option>
            <option>50</option>
          </select>
          <button id="btnExport" class="ghost">CSV書き出し</button>
          <input type="file" id="importFile" accept=".csv" style="display:none">
          <label for="importFile" class="ghost" style="display:inline-block; padding:12px 16px; border-radius:12px; cursor:pointer;">CSV読み込み</label>
        </div>
        <ul id="historyList" class="list"></ul>
      </div>
    </section>

    <!-- 分析 -->
    <section id="tab-analytics" class="tab">
      <div class="card">
        <h3>直近7日：合計ボリューム(kg)</h3>
        <canvas id="chart" width="800" height="280"></canvas>
        <div id="legend" class="legend"></div>
      </div>
      <div class="card">
        <h3>主要指標</h3>
        <div class="kv" id="metrics"></div>
      </div>
    </section>

    <!-- 設定 -->
    <section id="tab-settings" class="tab">
      <div class="card">
        <h3>種目管理</h3>

        <!-- 表示フィルタ（部位タブ） -->
        <div class="row" style="align-items:flex-start">
          <label>表示する部位</label>
          <nav id="filterPartTabs" class="pills"></nav>
        </div>

        <!-- 追加（部位タブ + 名前） -->
        <div class="row" style="align-items:flex-start">
          <input id="newExName" placeholder="例：ベンチプレス">
          <!-- 互換用 hidden（タブがここを書き換える） -->
          <select id="newExPart" style="display:none"></select>
          <button id="btnCreateEx">追加</button>
        </div>

        <ul id="exList" class="list"></ul>
      </div>

      <div class="card">
        <h3>通知 / データ</h3>
        <div class="row">
          <button id="btnNotif" class="ghost">通知を許可（休憩タイマー用）</button>
          <button id="btnWipe" class="danger">全データ削除</button>
        </div>
        <small>※ OSの通知設定でオフにしている場合は通知は表示されません。</small>
      </div>

      <div class="card">
        <h3>表示</h3>
        <div class="row">
          <label>ダークモード</label>
          <input id="darkToggle" type="checkbox">
        </div>
      </div>

      <div class="card">
        <h3>バックアップ</h3>
        <div class="row">
          <button id="btnExportJson" class="ghost">JSON書き出し</button>
          <label for="jsonIn" class="ghost" style="display:inline-block; padding:12px 16px; border-radius:12px; cursor:pointer;">JSON読み込み</label>
          <input id="jsonIn" type="file" accept="application/json" style="display:none">
        </div>
        <small>書き出しは端末に保存、読み込みはファイル選択で復元できます。</small>
      </div>

      <div class="card">
        <h3>情報</h3>
        <div class="kv">
          <div>バージョン</div><div>1.2.0</div>
          <div>プライバシー</div><div><a target="_blank" href="privacy.html">プライバシーポリシー</a></div>
          <div>サポート</div>
          <div><a href="mailto:toreninguguanli53@gmail.com?subject=Train%20Punch%20サポート">toreninguguanli53@gmail.com</a></div>
        </div>
        <small>当アプリはトレーニング記録を目的としたツールです。医療情報や効果を保証するものではありません。安全に配慮し、体調に異変があれば医療機関に相談してください。</small>
      </div>
    </section>
  </main>

  <div id="toast" class="toast"></div>
  <script src="app.js?v=1.2.1"></script>
  <script src="sw-register.js"></script>
</body>
</html>