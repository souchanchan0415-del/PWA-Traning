<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="theme-color" content="#0e1116">
  <meta name="format-detection" content="telephone=no">
  <meta name="color-scheme" content="light dark">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-180.png">

  <title>Train Punch v1.1.3</title>

  <!-- styles -->
  <link rel="preload" href="styles.css?v=1.1.3" as="style">
  <link rel="stylesheet" href="styles.css?v=1.1.3">
</head>
<body>
  <div id="app">
    <header class="topbar">
      <h1>Train Punch</h1>
    </header>

    <div id="toast" aria-live="polite"></div>

    <!-- Tabs -->
    <nav class="tabs" role="tablist">
      <button type="button" data-tab="session"  class="active" aria-selected="true">セッション</button>
      <button type="button" data-tab="history"  aria-selected="false">履歴</button>
      <button type="button" data-tab="analytics" aria-selected="false">分析</button>
      <button type="button" data-tab="settings" aria-selected="false">設定</button>
    </nav>

    <main>
      <!-- ========== SESSION TAB ========== -->
      <section id="tab-session" class="tab active" role="tabpanel">
        <!-- 日付＋カレンダー -->
        <section class="card">
          <header class="card-header">
            <h2>日付とカレンダー</h2>
          </header>
          <div class="card-body">
            <div class="sess-date-row">
              <label for="sessDate">日付</label>
              <input id="sessDate" type="date" inputmode="numeric">
            </div>

            <div class="mini-calender">
              <div class="cal-header">
                <button type="button" id="calPrevMonth" class="ghost">&lt;</button>
                <div id="calMonthLabel" class="cal-month-label">----</div>
                <button type="button" id="calNextMonth" class="ghost">&gt;</button>
              </div>
              <div class="cal-weekdays">
                <span>日</span><span>月</span><span>火</span><span>水</span><span>木</span><span>金</span><span>土</span>
              </div>
              <div id="calGrid" class="cal-grid" aria-label="セッションカレンダー"></div>
            </div>
          </div>
        </section>

        <!-- ★ クイック/カスタム投入カードは削除済み ★ -->

        <!-- セッション編集カード -->
        <section id="sessionEditCard" class="card">
          <header class="card-header">
            <h2>今日のトレーニング</h2>
          </header>
          <div class="card-body">
            <!-- 部位チップ -->
            <div class="chip-row" id="partChips" aria-label="部位">
              <button type="button" class="chip active" data-part="胸">胸</button>
              <button type="button" class="chip" data-part="背中">背中</button>
              <button type="button" class="chip" data-part="脚">脚</button>
              <button type="button" class="chip" data-part="肩">肩</button>
              <button type="button" class="chip" data-part="腕">腕</button>
              <button type="button" class="chip" data-part="体幹">体幹</button>
            </div>

            <!-- 入力行 -->
            <div class="form-grid">
              <label class="field">
                <span>種目</span>
                <select id="exSelect">
                  <option value="">（選択する）</option>
                </select>
              </label>
              <label class="field">
                <span>重量 (kg)</span>
                <input id="weight" type="number" inputmode="decimal" placeholder="60">
              </label>
              <label class="field">
                <span>回数</span>
                <input id="reps" type="number" inputmode="numeric" placeholder="8">
              </label>
              <label class="field">
                <span>セット数</span>
                <input id="sets" type="number" inputmode="numeric" placeholder="1">
              </label>
              <label class="field">
                <span>RPE</span>
                <input id="rpe" type="number" inputmode="decimal" min="1" max="10" step="0.5" placeholder="8">
              </label>
            </div>

            <p class="hint small">※「60x8x3@8」のようにまとめて入力してもOK（スマート入力）</p>

            <div class="btn-row">
              <button type="button" id="btnAddSet" class="primary">セットを追加</button>
              <button type="button" id="btnUndo" class="ghost">1つ戻す</button>
            </div>

            <div class="field">
              <label for="sessNote">メモ</label>
              <textarea id="sessNote" rows="2" placeholder="今日のコンディションなど"></textarea>
            </div>

            <div class="btn-row end">
              <button type="button" id="btnSaveSession" class="primary">セッションを保存</button>
            </div>

            <hr>

            <h3 class="subheading">今日のセット</h3>
            <ul id="todaySets" class="list">
              <li>まだありません</li>
            </ul>
          </div>
        </section>
      </section>

      <!-- ========== HISTORY TAB ========== -->
      <section id="tab-history" class="tab" role="tabpanel" hidden>
        <section class="card">
          <header class="card-header">
            <h2>履歴一覧</h2>
          </header>
          <div class="card-body">
            <div class="field-inline">
              <label for="historyCount">表示件数</label>
              <select id="historyCount">
                <option value="10">10件</option>
                <option value="20" selected>20件</option>
                <option value="50">50件</option>
                <option value="100">100件</option>
              </select>
            </div>
            <ul id="historyList" class="list">
              <li>まだありません</li>
            </ul>
          </div>
        </section>

        <section class="card">
          <header class="card-header">
            <h2>CSVエクスポート / インポート</h2>
          </header>
          <div class="card-body">
            <div class="btn-row">
              <button type="button" id="btnExport" class="ghost">CSVを書き出し</button>
            </div>

            <div class="import-area">
              <div id="importDrop" class="drop-zone" tabindex="0">
                <p class="import-title">CSVをインポート</p>
                <p class="import-file-name">ファイル未選択</p>
                <p class="import-status">
                  <span class="dot"></span> 待機中
                </p>
              </div>
              <input id="importFile" type="file" accept=".csv,text/csv" hidden>
            </div>
          </div>
        </section>
      </section>

      <!-- ========== ANALYTICS TAB ========== -->
      <section id="tab-analytics" class="tab" role="tabpanel" hidden>
        <section class="card">
          <header class="card-header">
            <h2>ウォッチ種目トレンド</h2>
          </header>
          <div class="card-body">
            <div class="field">
              <label for="trendExSelect">種目</label>
              <select id="trendExSelect">
                <option value="">ウォッチ種目から選択</option>
              </select>
            </div>
            <div class="chart-wrap">
              <!-- 実際の描画は JS 側で -->
              <canvas id="trendChart" aria-label="ウォッチ種目トレンド"></canvas>
            </div>
          </div>
        </section>

        <section class="card">
          <header class="card-header">
            <h2>週間サマリー</h2>
          </header>
          <div class="card-body">
            <div id="weeklySummary" class="weekly-summary">
              <!-- JS が埋め込む -->
              <p class="small muted">記録を保存するとここに1週間分のサマリーが表示されます。</p>
            </div>
          </div>
        </section>
      </section>

      <!-- ========== SETTINGS TAB ========== -->
      <section id="tab-settings" class="tab" role="tabpanel" hidden>
        <!-- データステータス / 今日のワンポイント -->
        <section id="dataStatusCard" class="card">
          <header class="card-header">
            <h2 id="dataStatusTitle">データステータス</h2>
          </header>
          <div class="card-body">
            <p id="dataStatusBody" class="small">読み込み中…</p>
          </div>
        </section>

        <!-- 種目管理 -->
        <section class="card">
          <header class="card-header">
            <h2>種目管理</h2>
          </header>
          <div class="card-body">
            <div class="form-grid">
              <label class="field">
                <span>種目名</span>
                <input id="newExName" type="text" placeholder="ベンチプレス">
              </label>
              <label class="field">
                <span>部位</span>
                <select id="newExPart">
                  <option value="">（任意）</option>
                  <option value="胸">胸</option>
                  <option value="背中">背中</option>
                  <option value="脚">脚</option>
                  <option value="肩">肩</option>
                  <option value="腕">腕</option>
                  <option value="体幹">体幹</option>
                </select>
              </label>
            </div>
            <div class="btn-row">
              <button type="button" id="btnCreateEx" class="primary">種目を追加</button>
            </div>

            <hr>

            <div class="field-inline">
              <label for="filterPart">種目の絞り込み</label>
              <select id="filterPart">
                <option value="all" selected>すべて</option>
                <option value="胸">胸</option>
                <option value="背中">背中</option>
                <option value="脚">脚</option>
                <option value="肩">肩</option>
                <option value="腕">腕</option>
                <option value="体幹">体幹</option>
              </select>
            </div>

            <div id="partFilter" class="chip-row" aria-label="表示する部位フィルタ">
              <!-- JSで部位チップを描画 -->
            </div>

            <ul id="exerciseList" class="list">
              <li>まだありません</li>
            </ul>
          </div>
        </section>

        <!-- ウォッチリスト -->
        <section class="card">
          <header class="card-header">
            <h2>ウォッチ種目</h2>
          </header>
          <div class="card-body">
            <div id="watchPartChips" class="chip-row" aria-label="部位（ウォッチ）">
              <button type="button" class="chip active" data-part="胸">胸</button>
              <button type="button" class="chip" data-part="背中">背中</button>
              <button type="button" class="chip" data-part="脚">脚</button>
              <button type="button" class="chip" data-part="肩">肩</button>
              <button type="button" class="chip" data-part="腕">腕</button>
              <button type="button" class="chip" data-part="体幹">体幹</button>
            </div>

            <div class="form-grid">
              <label class="field">
                <span>種目</span>
                <select id="watchExSelect">
                  <option value="">（選択する）</option>
                </select>
              </label>
            </div>

            <div class="btn-row">
              <button type="button" id="btnWatchAdd" class="primary">ウォッチに追加</button>
            </div>

            <ul id="watchList" class="list">
              <li>まだありません</li>
            </ul>
          </div>
        </section>

        <!-- バックアップ / リセット / 通知 -->
        <section class="card">
          <header class="card-header">
            <h2>バックアップとその他</h2>
          </header>
          <div class="card-body">
            <div class="btn-row">
              <button type="button" id="btnNotif" class="ghost">通知を許可（対応端末のみ）</button>
            </div>

            <h3 class="subheading">JSONバックアップ</h3>
            <div class="btn-row">
              <button type="button" id="btnExportJson" class="ghost">JSONを書き出し</button>
            </div>
            <div class="field">
              <label for="jsonIn">JSONから復元</label>
              <input id="jsonIn" type="file" accept="application/json">
            </div>

            <hr>

            <h3 class="subheading">キャッシュ / データ</h3>
            <div class="btn-row">
              <button type="button" id="btnHardRefresh" class="ghost">キャッシュをリセット</button>
            </div>
            <div class="btn-row">
              <button type="button" id="btnWipe" class="danger">全データを削除</button>
            </div>
            <p class="small muted">※全データ削除は元に戻せません。バックアップを取ってから行ってください。</p>
          </div>
        </section>
      </section>
    </main>
  </div>

  <!-- グローバル定数（app.js で参照） -->
  <script>
    const PARTS = ['胸', '背中', '脚', '肩', '腕', '体幹'];

    const EX_GROUPS = {
      '胸':   ['ベンチプレス', 'インクラインベンチプレス', 'ダンベルフライ'],
      '背中': ['デッドリフト', 'ラットプルダウン', 'ベントオーバーロウ'],
      '脚':   ['スクワット', 'レッグプレス', 'ルーマニアンデッドリフト'],
      '肩':   ['ショルダープレス', 'サイドレイズ'],
      '腕':   ['バーベルカール', 'トライセプスエクステンション'],
      '体幹': ['プランク', 'ロシアンツイスト']
    };

    const SETTINGS_TIPS = [
      'まずは週2〜3回、無理のない頻度から始めましょう。',
      'セットごとにRPEをつけると疲労管理がしやすくなります。',
      '週単位でボリュームを見直すと伸びやすい負荷が分かります。',
      '扱う重量よりもフォームの安定を最優先にしましょう。',
      '連続で重い日が続いたら、1日は軽めの日を入れてみましょう。',
      '伸び悩んだら、回数ゾーンを変えてみるのも一つの方法です。'
    ];
  </script>

  <!-- Chart.js（分析タブ用） -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // SW register
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(() => {});
      });
    }
  </script>
  <script src="app.js?v=1.1.3"></script>
</body>
</html>